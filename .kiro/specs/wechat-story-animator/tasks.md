# 实施计划

- [x] 1. 扩展消息类型定义和数据模型

  - 在 `src/components/ChatInterface.tsx` 中扩展 Message 接口
  - 添加语音、图片、撤回等新消息类型
  - 添加消息状态、动画延迟等新字段
  - _需求: 1.1, 2.1, 3.1, 5.1_

- [x] 2. 实现语音消息组件

  - [x] 2.1 创建 VoiceMessage 组件基础结构

    - 创建 `src/components/VoiceMessage.tsx` 文件
    - 实现绿色语音条 UI 布局
    - 添加时长显示（如"10""）
    - _需求: 1.1, 1.2_

  - [x] 2.2 实现语音转文字功能
    - 在语音条下方添加文字显示区域
    - 实现文字渐显动画效果
    - 添加未播放红点提示
    - _需求: 1.3, 1.4, 1.5_

- [x] 3. 实现图片消息组件

  - [x] 3.1 创建 ImageMessage 组件

    - 创建 `src/components/ImageMessage.tsx` 文件
    - 实现单图和多图布局
    - 保持图片宽高比
    - _需求: 2.1, 2.4, 2.5_

  - [x] 3.2 添加图片加载动画
    - 实现渐显加载效果
    - 添加图片描述文字支持
    - 处理图片加载失败情况
    - _需求: 2.2, 2.3_

- [x] 4. 实现消息状态显示功能

  - [x] 4.1 创建 MessageStatus 组件

    - 创建 `src/components/MessageStatus.tsx` 文件
    - 实现发送中转圈动画
    - 添加状态图标显示
    - _需求: 3.1_

  - [x] 4.2 实现状态转换逻辑
    - 集成 MessageStatus 组件到 MessageBubble
    - 在 ChatInterface 中添加消息状态显示逻辑
    - 实现状态转换动画效果
    - _需求: 3.2, 3.3_

- [x] 5. 增强输入状态功能

  - [x] 5.1 改进 TypingIndicator 组件

    - 在顶部导航栏显示"对方正在输入..."
    - 支持配置持续时间（短/中/长）
    - _需求: 4.1, 4.2_

  - [x] 5.2 实现犹豫效果

    - 添加输入-停止-再输入动画
    - 支持多人同时输入显示
    - 实现平滑过渡效果
    - _需求: 4.3, 4.4, 4.5_

  - [x] 5.3 集成导航栏输入状态显示
    - 在 WeChatNavBar 组件中添加"正在输入..."显示
    - 与 TypingIndicator 组件联动
    - 实现状态同步和动画效果
    - _需求: 4.1, 4.2_

- [x] 6. 实现消息撤回功能

  - [x] 6.1 创建 RecallMessage 组件

    - 创建 `src/components/RecallMessage.tsx` 文件
    - 实现消息消失动画
    - 显示系统提示文字
    - _需求: 5.1, 5.2_

  - [x] 6.2 添加撤回控制逻辑
    - 优化撤回动画时序控制
    - 实现连续撤回功能
    - 添加重新编辑选项支持
    - _需求: 5.3, 5.4, 5.5_

- [x] 7. 实现动画时间控制系统

  - [x] 7.1 创建 AnimationController

    - 创建 `src/hooks/useAnimationController.ts` 文件
    - 实现三级延迟配置（短/中/长）
    - 添加全局速度控制
    - _需求: 6.1, 6.2_

  - [x] 7.2 优化动画节奏
    - 在 useAnimationControl 中实现描述性时间支持（"稍后"、"片刻后"等）
    - 添加自动优化过长等待的逻辑
    - 集成 AnimationController 到主要动画流程
    - _需求: 6.3, 6.4, 6.5_

- [x] 8. 增强 YAML 解析器

  - [x] 8.1 扩展 yamlParser

    - 在 `src/lib/yamlParser.ts` 中添加新消息类型支持
    - 实现时间描述符解析（短/中/长）
    - 添加配置验证逻辑
    - _需求: 10.1, 10.3, 10.5_

  - [x] 8.2 创建场景模板系统
    - 创建 `src/lib/sceneTemplates.ts` 文件
    - 实现表白、分手、道歉等预设模板
    - 添加主题色彩和动画预设支持
    - 在配置面板中集成模板选择功能
    - _需求: 10.2, 10.4_

- [ ] 9. 实现场景切换功能

  - [ ] 9.1 创建通讯录界面

    - 创建 `src/components/ContactListView.tsx` 文件
    - 实现联系人列表布局和搜索功能
    - 添加群聊和私聊分类显示
    - 实现联系人头像和最后消息预览
    - _需求: 7.1, 7.3_

  - [ ] 9.2 实现界面切换动画
    - 在主应用中添加场景切换状态管理
    - 实现通讯录到聊天界面的滑动切换效果
    - 添加导航栏切换动画
    - _需求: 7.2, 7.4, 7.5_

- [ ] 10. 增强动画效果

  - [ ] 10.1 实现文字特效

    - 在 MessageBubble 组件中添加逐字显示效果
    - 实现文字淡入淡出动画
    - 添加打字机效果配置选项
    - _需求: 8.2, 8.3_

  - [ ] 10.2 实现视觉特效

    - 在 ChatInterface 中添加消息聚焦放大效果
    - 实现背景模糊功能和镜头效果
    - 优化动画性能和内存使用
    - _需求: 8.4, 8.5_

  - [ ] 10.3 增强 CSS 动画库
    - 在 `src/index.css` 中添加更多动画效果
    - 实现消息弹入、滑入等动画
    - 添加状态转换动画样式
    - _需求: 8.1, 8.2_

- [ ] 11. 优化导出功能

  - [x] 11.1 增强 GIF 导出

    - 在 `src/hooks/useGifExport.ts` 中添加质量和尺寸配置
    - 实现导出进度显示
    - 优化 GIF 文件大小和帧率
    - _需求: 9.2, 9.5_

  - [ ] 11.2 添加截图序列导出
    - 创建 `src/hooks/useScreenshotExport.ts` 文件
    - 实现批量截图功能和水印支持
    - 在 PlaybackControls 中添加截图导出选项
    - _需求: 9.3, 9.4_

- [ ] 12. 实现预览控制功能

  - [ ] 12.1 创建时间轴控制器

    - 创建 `src/components/TimelineControl.tsx` 文件
    - 实现拖动预览功能和关键帧标记
    - 集成到 PlaybackControls 组件
    - _需求: 11.1, 11.4_

  - [ ] 12.2 添加播放控制
    - 在 PlaybackControls 中添加循环播放模式
    - 扩展变速播放功能（已有基础实现）
    - 实现撤销/重做操作状态管理
    - _需求: 11.2, 11.3, 11.5_

- [x] 13. 集成所有组件到 ChatInterface

  - 更新 `src/components/ChatInterface.tsx` 主组件
  - 添加新消息类型的渲染逻辑
  - 集成动画控制系统
  - 确保向后兼容性
  - _需求: 所有需求集成_

- [ ] 14. 编写集成测试

  - [ ] 14.1 创建组件测试

    - 为 VoiceMessage、ImageMessage、RecallMessage 等组件编写单元测试
    - 测试动画序列和状态转换
    - 验证 YAML 解析器的扩展功能
    - _需求: 测试覆盖_

  - [ ] 14.2 创建端到端测试
    - 测试完整的故事播放流程（包含语音、图片、撤回等）
    - 验证增强的 YAML 配置解析
    - 测试 GIF 导出和截图功能
    - _需求: 质量保证_

- [ ] 15. 创建示例和文档

  - [ ] 15.1 创建示例配置文件

    - 更新现有示例文件以展示新功能（语音、图片、撤回等）
    - 创建复杂动画和特效示例
    - 添加详细的配置说明注释
    - _需求: 用户指导_

  - [ ] 15.2 更新 README 文档
    - 添加语音、图片、撤回等新功能使用说明
    - 更新 YAML 配置语法文档
    - 添加动画控制和导出功能说明
    - _需求: 文档完善_

- [ ] 16. 修复和优化现有功能

  - [x] 16.1 修复动画控制集成

    - 在主应用中集成 useAnimationController hook
    - 确保动画控制器与播放控制器正确协作
    - 修复动画时序和状态同步问题
    - _需求: 6.1, 6.2, 6.3_

  - [ ] 16.2 优化消息状态显示

    - 在 VoiceMessage 和 ImageMessage 组件中集成 MessageStatus
    - 确保消息状态在所有消息类型中正确显示
    - 优化状态转换动画的性能
    - _需求: 3.1, 3.2, 3.3_

  - [x] 16.3 完善导航栏输入状态集成

    - 在主应用中集成 WeChatNavBar 的输入状态显示
    - 确保输入状态与 TypingIndicator 正确同步
    - 添加多用户输入状态支持
    - _需求: 4.1, 4.2, 4.5_

  - [ ] 16.4 增强 YAML 配置支持

    - 在 Message 接口中添加 hesitate 字段
    - 在 yamlParser 中添加对 hesitate 字段的完整支持
    - 在 ChatInterface 中将 hesitate 字段传递给 TypingIndicator
    - 完善主题配置和动画配置的完整解析
    - _需求: 10.1, 10.3, 10.5_

  - [x] 16.5 完善动画效果
    - 在 index.css 中添加 fadeIn 和其他缺失的动画样式
    - 优化消息显示的过渡动画
    - 添加更多视觉特效支持
    - _需求: 8.1, 8.2, 8.3_
